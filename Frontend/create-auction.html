<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Create Auction - NFT Auction Private</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar">
        <div class="nav-container">
            <a href="dashboard.html" class="nav-brand">üé® NFT Auction</a>
            <ul class="nav-menu">
                <li><a href="dashboard.html" class="nav-link">Dashboard</a></li>
                <li><a href="create-auction.html" class="nav-link active">Create Auction</a></li>
                <li><a href="my-auctions.html" class="nav-link">My Auctions</a></li>
                <li><a href="profile.html" class="nav-link">Profile</a></li>
                <li>
                    <span class="wallet-badge">
                        üí∞ <span id="walletBalance">10,000</span> tokens
                    </span>
                </li>
            </ul>
        </div>
    </nav>

    <div class="container">
        <!-- Page Header -->
        <div class="page-header">
            <h1>üöÄ Create New Auction</h1>
            <p>List your NFT for privacy-preserving auction</p>
        </div>

        <div class="card-grid" style="grid-template-columns: 2fr 1fr;">
            <!-- Auction Form -->
            <div class="card">
                <div class="card-header">
                    <h2>üìù Auction Details</h2>
                </div>

                <form id="auctionForm">
                    <!-- Seller Address -->
                    <div class="form-group">
                        <label for="sellerAddress">
                            Seller Address *
                        </label>
                        <input 
                            type="text" 
                            id="sellerAddress" 
                            class="form-control" 
                            placeholder="0x..." 
                            readonly
                        />
                        <small>Your wallet address (auto-filled)</small>
                    </div>

                    <!-- NFT ID -->
                    <div class="form-group">
                        <label for="nftId">
                            NFT ID / Token ID *
                        </label>
                        <input 
                            type="text" 
                            id="nftId" 
                            class="form-control" 
                            placeholder="e.g., 12345 or 0xabc..." 
                            required
                        />
                        <small>Enter the unique identifier for your NFT</small>
                    </div>

                    <!-- NFT Name -->
                    <div class="form-group">
                        <label for="nftName">
                            NFT Name
                        </label>
                        <input 
                            type="text" 
                            id="nftName" 
                            class="form-control" 
                            placeholder="e.g., Bored Ape #123" 
                        />
                        <small>Optional: Give your NFT a display name</small>
                    </div>

                    <!-- Description -->
                    <div class="form-group">
                        <label for="description">
                            Description
                        </label>
                        <textarea 
                            id="description" 
                            class="form-control" 
                            rows="3" 
                            placeholder="Describe your NFT..."
                        ></textarea>
                        <small>Optional: Add details about the NFT</small>
                    </div>

                    <!-- End Time -->
                    <div class="form-group">
                        <label for="endTime">
                            Auction Duration (hours) *
                        </label>
                        <input 
                            type="number" 
                            id="endTime" 
                            class="form-control" 
                            placeholder="24" 
                            min="1" 
                            max="168" 
                            value="24" 
                            required
                        />
                        <small>How many hours from now should the auction end? (Max: 168 = 7 days)</small>
                    </div>

                    <!-- Reserve Price -->
                    <div class="form-group">
                        <label for="reservePrice">
                            Reserve Price (tokens) *
                        </label>
                        <input 
                            type="number" 
                            id="reservePrice" 
                            class="form-control" 
                            placeholder="1000" 
                            min="1" 
                            required
                        />
                        <small>Minimum price to sell your NFT (must be at least 1 token)</small>
                    </div>

                    <!-- Minimum Bid Increment -->
                    <div class="form-group">
                        <label for="minIncrement">
                            Minimum Bid Increment (tokens)
                        </label>
                        <input 
                            type="number" 
                            id="minIncrement" 
                            class="form-control" 
                            placeholder="100" 
                            min="1" 
                            value="100"
                        />
                        <small>Minimum amount each bid must increase by</small>
                    </div>

                    <!-- Privacy Settings -->
                    <div class="form-group">
                        <label>
                            <input type="checkbox" id="hideBidders" checked />
                            Hide bidder identities (zero-knowledge proofs)
                        </label>
                        <br/>
                        <label style="margin-top: 0.5rem;">
                            <input type="checkbox" id="hideAmounts" />
                            Hide bid amounts until auction ends
                        </label>
                    </div>

                    <!-- Transaction Fee Info -->
                    <div class="alert alert-info">
                        <strong>‚ÑπÔ∏è Transaction Cost:</strong> Creating an auction costs <strong>5 tokens</strong> (transaction fee)
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" class="btn btn-primary btn-block" style="font-size: 1.1rem; padding: 1rem;">
                        üöÄ Create Auction (Cost: 5 tokens)
                    </button>
                </form>
            </div>

            <!-- Preview & Info -->
            <div>
                <!-- Auction Preview -->
                <div class="card" style="margin-bottom: 2rem;">
                    <div class="card-header">
                        <h2>üëÅÔ∏è Preview</h2>
                    </div>
                    <div style="padding: 1rem; background: #f8f9fa; border-radius: 8px; margin-bottom: 1rem; text-align: center;">
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üé®</div>
                        <div style="font-weight: bold; color: var(--primary-color);" id="previewName">Your NFT</div>
                    </div>
                    <div class="form-group">
                        <label>Token ID</label>
                        <div id="previewId" style="font-family: monospace; color: #666;">Not set</div>
                    </div>
                    <div class="form-group">
                        <label>Reserve Price</label>
                        <div id="previewPrice" style="font-size: 1.3rem; font-weight: bold; color: var(--primary-color);">0 tokens</div>
                    </div>
                    <div class="form-group">
                        <label>Ends In</label>
                        <div id="previewTime" style="font-weight: 600;">24 hours</div>
                    </div>
                </div>

                <!-- Your Balance -->
                <div class="card">
                    <div class="card-header">
                        <h2>üí≥ Your Wallet</h2>
                    </div>
                    <div style="text-align: center; padding: 1rem;">
                        <div style="font-size: 2rem; font-weight: bold; color: var(--success-color);">
                            <span id="currentBalance">10,000</span>
                        </div>
                        <div style="color: #666; margin-top: 0.5rem;">Available tokens</div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 8px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
                            <span>Current balance:</span>
                            <strong><span id="balanceBefore">10,000</span> tokens</strong>
                        </div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 0.5rem; color: var(--danger-color);">
                            <span>Creation fee:</span>
                            <strong>- 5 tokens</strong>
                        </div>
                        <div style="border-top: 2px solid #ddd; padding-top: 0.5rem; margin-top: 0.5rem;">
                            <div style="display: flex; justify-content: space-between;">
                                <span><strong>After creation:</strong></span>
                                <strong style="color: var(--success-color);"><span id="balanceAfter">9,995</span> tokens</strong>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tips -->
                <div class="card" style="margin-top: 2rem;">
                    <div class="card-header">
                        <h2>üí° Tips</h2>
                    </div>
                    <ul style="list-style: none; padding-left: 0; color: #666;">
                        <li style="margin-bottom: 0.5rem;">‚úì Set a realistic reserve price</li>
                        <li style="margin-bottom: 0.5rem;">‚úì Longer auctions get more bids</li>
                        <li style="margin-bottom: 0.5rem;">‚úì Enable privacy for sensitive NFTs</li>
                        <li style="margin-bottom: 0.5rem;">‚úì Double-check all details before creating</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Transaction Log -->
        <div class="card" style="margin-top: 2rem;">
            <div class="card-header">
                <h2>üìù Activity Log</h2>
            </div>
            <div id="logContainer" style="max-height: 200px; overflow-y: auto; background: #f8f9fa; padding: 1rem; border-radius: 8px; font-family: 'Courier New', monospace; font-size: 14px;">
                <p style="color: #888;">Ready to create auction...</p>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'http://localhost:3000';

        // Add log entry
        function addLog(message, type = 'info') {
            const logContainer = document.getElementById('logContainer');
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.style.marginBottom = '8px';
            
            const colors = {
                success: '#28a745',
                error: '#dc3545',
                warning: '#ffc107',
                info: '#17a2b8'
            };
            
            logEntry.style.color = colors[type] || '#555';
            logEntry.innerHTML = `<strong>[${timestamp}]</strong> ${message}`;
            
            if (logContainer.firstElementChild?.textContent === 'Ready to create auction...') {
                logContainer.innerHTML = '';
            }
            
            logContainer.appendChild(logEntry);
            logContainer.scrollTop = logContainer.scrollHeight;
        }

        // Load wallet info
        async function loadWalletInfo() {
            try {
                const response = await fetch(`${API_BASE}/wallet`);
                const data = await response.json();
                
                if (data.success && data.wallet) {
                    const balance = parseInt(data.wallet.balance);
                    document.getElementById('walletBalance').textContent = balance.toLocaleString();
                    document.getElementById('currentBalance').textContent = balance.toLocaleString();
                    document.getElementById('balanceBefore').textContent = balance.toLocaleString();
                    document.getElementById('balanceAfter').textContent = (balance - 5).toLocaleString();
                    document.getElementById('sellerAddress').value = data.wallet.shieldedAddress || '0x...';
                }
            } catch (error) {
                addLog('‚ö†Ô∏è Could not load wallet info', 'warning');
            }
        }

        // Update preview
        function updatePreview() {
            const nftName = document.getElementById('nftName').value || 'Your NFT';
            const nftId = document.getElementById('nftId').value || 'Not set';
            const reservePrice = document.getElementById('reservePrice').value || '0';
            const endTime = document.getElementById('endTime').value || '24';
            
            document.getElementById('previewName').textContent = nftName;
            document.getElementById('previewId').textContent = nftId;
            document.getElementById('previewPrice').textContent = `${reservePrice} tokens`;
            document.getElementById('previewTime').textContent = `${endTime} hours`;
        }

        // Form inputs - update preview on change
        ['nftName', 'nftId', 'reservePrice', 'endTime'].forEach(id => {
            document.getElementById(id).addEventListener('input', updatePreview);
        });

        // Form submission
        document.getElementById('auctionForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = {
                sellerAddress: document.getElementById('sellerAddress').value,
                nftId: document.getElementById('nftId').value,
                nftName: document.getElementById('nftName').value,
                description: document.getElementById('description').value,
                endTime: parseInt(document.getElementById('endTime').value),
                reservePrice: parseInt(document.getElementById('reservePrice').value),
                minIncrement: parseInt(document.getElementById('minIncrement').value),
                hideBidders: document.getElementById('hideBidders').checked,
                hideAmounts: document.getElementById('hideAmounts').checked
            };

            // Validation
            if (!formData.nftId) {
                addLog('‚ùå Please enter an NFT ID', 'error');
                return;
            }
            if (formData.reservePrice < 1) {
                addLog('‚ùå Reserve price must be at least 1 token', 'error');
                return;
            }

            addLog('‚è≥ Creating auction...', 'info');
            addLog(`üìã NFT ID: ${formData.nftId}`, 'info');
            addLog(`üí∞ Reserve Price: ${formData.reservePrice} tokens`, 'info');
            addLog(`‚è∞ Duration: ${formData.endTime} hours`, 'info');

            try {
                // Call start auction endpoint
                const response = await fetch(`${API_BASE}/auction/start`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                
                const data = await response.json();
                
                if (data.success) {
                    addLog('‚úÖ Auction created successfully!', 'success');
                    addLog(`üí∏ Transaction fee: 5 tokens`, 'warning');
                    addLog(`üí∞ New balance: ${data.walletBalance || 'N/A'} tokens`, 'info');
                    
                    // Update balance display
                    if (data.walletBalance) {
                        const newBalance = parseInt(data.walletBalance);
                        document.getElementById('walletBalance').textContent = newBalance.toLocaleString();
                        document.getElementById('currentBalance').textContent = newBalance.toLocaleString();
                        document.getElementById('balanceBefore').textContent = newBalance.toLocaleString();
                        document.getElementById('balanceAfter').textContent = (newBalance - 5).toLocaleString();
                    }
                    
                    // Show success message
                    setTimeout(() => {
                        if (confirm('Auction created! Go to dashboard to manage it?')) {
                            window.location.href = 'dashboard.html';
                        } else {
                            // Reset form
                            document.getElementById('auctionForm').reset();
                            updatePreview();
                            addLog('Ready to create another auction...', 'info');
                        }
                    }, 1000);
                } else {
                    addLog(`‚ùå Failed to create auction: ${data.error}`, 'error');
                }
            } catch (error) {
                addLog(`‚ùå Error: ${error.message}`, 'error');
            }
        });

        // Initialize
        loadWalletInfo();
        updatePreview();
        addLog('‚úÖ Form ready', 'success');
    </script>
</body>
</html>
